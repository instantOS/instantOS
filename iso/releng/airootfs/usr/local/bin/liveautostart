#!/bin/bash

# this script autostarts on an instantOS live session

echo "applying live session tweaks"

if command -v systemctl; then
    sudo systemctl enable --now systemd-timesyncd
    if command -v tzupdate; then
        sleep 10
        sudo tzupdate
    fi &
fi

mem_kb=$(awk '/MemTotal/ {print $2}' /proc/meminfo)
size_arg="512M"

mem_gib=$(( mem_kb / 1024 / 1024 ))
if (( mem_gib >= 2 )); then
    cow_gib=$(( mem_gib / 2 ))
    size_arg="${cow_gib}G"
fi

if mountpoint -q /run/archiso/cowspace; then
    echo "setting cowspace size to $size_arg"
    mount -o remount,size="$size_arg" /run/archiso/cowspace
fi

echo "finished applying live session tweaks"
